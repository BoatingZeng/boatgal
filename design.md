#效果

##整体画面
1. 震动摇晃之类的

##文字区
1. 打字机效果，外加淡入等美化效果
2. 段落结束后，末尾加动态的等待提示

##背景
1. 背景切换时加一些幻灯片式过渡效果

##人物
1. 人物表情切换时尝试加过渡效果，使之有动感

##声音
1. BGM
2. 效果音，尽量灵活地插入

#数据结构
`boatgal`作为全局对象(命名空间)。

游戏数据由`asset`、`scenario`、`config`三个对象描述。
这三个对象在服务器有独立的`json`文件储存。
1. `asset`指代整个游戏资源,具体格式参见`createjs`的`preloadjs`的`manifest`。
2. `scenario`指剧本，具体见剧本细节。
3. `config`记录一些设定。

##剧本细节
用简单的分支结构,剧本数据格式如下：
```json
  {
    "part0": [
      {
        "bg": "",
        "bgm": "",
        "figures": [{"id": "", "position": {"x": 0, "y": 0}}],
        "dialog": {"speaker": "", "speech": ""},
        "effect": {}
      }
    ]
  }
```

1. `scenario {Object}`: 剧本整体,分成多个无关的`part`。
```
   {
     partX {Array}: 一个partX数组,剧本的一部分,这部分内部会顺序执行,X是整数,从0开始,change对象的集合。
   }
```

2. `change {Object}`: `part`的元素,表示舞台的变化,添加或者切换某一类舞台元素(指背景、音效、人物、台词等),则把要添加或者切换后的舞台元素写在`change`中;要去除,则写`"off"`,`figures`则用空数组表示去除。变化以`change`的直接子元素为基础,即,`figures`这类本身是`Array`或`Object`的元素,一旦改变,就是改变整个`Array`和`Object`。`change`中改变最频繁的是`dialog`元素。
```
   {
     bg {String}: 背景图片的id,背景图片的位置会设定为(0,0)
     bgm {String}: 背景音乐的id
     figures {Array}: figure对象的集合
     dialog {Object}: 
     effect {Object}:
   }
```

3. `figure {Object}`: 表示一张非背景图片。
```
   {
     id {String}: 图片id
     position {Object}: 表示图片位置。包含x {Num}, y {Num}属性。
   }
```

4. `dialog {Object}`: 表示一句(段)对话
```
   {
     speaker {String}: 说话人名称
     speech {String}: 所说的话
   }
```

5. `effect {Object}`: 描述效果,代表这整个`change`要展示的效果

###效果器(effect object)
该object的属性名是各种效果的名称。

####分支效果器
1. `branch {Array}`: 描述分支选项，只在`part`的最后一个`change`有该效果。是`choice`的集合。

2. `choice {Object}`: 包含要显示的文字和要跳转至的part。
```
   {
    text {String}: 在出现分支选项时，选项上显示的文字。
    targetPart {String}: 要跳转至的目标part。
   }
```

#工作流程

##梗概
1. 通过`preloadjs`加载`asset.json`中的资源
2. 加载完毕后开始游戏,游戏过程中不需要后台参与。

##细节

###加载过程
加载过程中显示加载画面。

###游戏(标题)画面
正式从剧本开始前，先插入一个标题画面。不同的游戏,标题画面不同,可以互动。所以每个游戏都可以有一个负责显示标题画面的脚本。有一个默认脚本,以供没有自定义标题画面的游戏使用。

###剧本本体的进行过程
有一个描述舞台上要展示的事物的对象。剧本进行的过程就是把要展示的事物记录到该对象,然后展示。剧本中,除了`part`的开头,记录的都是舞台的变化,而不是完整的舞台。所以游戏一定要从`part`的开头开始,或者把完整的舞台状态记录下来,从这个被记录的状态开始,这就是游戏的存档功能。

###渲染器的特性
对渲染器而言，无论提供给渲染器的渲染对象是完整的舞台对象，还是只表示变化的对象，渲染过程都是一样的。因为剧本的进行就是把要**变化**(变化指添加、删除、修改)的部分应用到舞台。所以，如果渲染的是完整的舞台对象，就当作整个舞台都发生**变化**。

###事件的处理
主要是处理点击事件。

关于正常顺序流程时的点击事件，处理分支时的点击事件。

1. 方案一：都注册在`stage`上，并且在`beginScenario`里注册。分支效果器只把分支相关的元素放到`stage`上。这样流程控制就统一在`beginScenario`管理了。
2. 方案二: 注册在`branch`效果器函数所生成的对象上。

决定使用方案一，这样需要在`beginScenario`中控制移除在`branch`中添加到`stage`的元素。

###自定义属性
关于给舞台对象(`DisplayObject`)添加自定义属性。属性名格式为`gal_name`,`name`则为自定义属性的名称名。
